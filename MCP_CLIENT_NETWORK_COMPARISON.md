# MCP 客户端网络限制对比

## 概述

不同的 MCP 客户端（AI IDE 和 CLI 工具）对 MCP 服务器的网络访问有不同的限制策略。本文档对比了主流工具的网络访问特性。

## 网络限制对比表

| 客户端类型 | 工具名称 | 局域网访问 | 公网访问 | 沙箱环境 | 备注 |
|----------|---------|----------|---------|---------|------|
| **AI IDE** | Cursor | ❌ 受限 | ✅ 允许 | 是 | 限制私有 IP (192.168.x.x, 10.x.x.x) |
| **AI IDE** | Windsurf | ❌ 可能受限 | ✅ 允许 | 可能 | 类似 Cursor 的安全策略 |
| **AI IDE** | Kiro | ⚠️ 待确认 | ✅ 允许 | 未知 | 需要实际测试 |
| **AI IDE** | Qoder | ⚠️ 待确认 | ✅ 允许 | 未知 | 需要实际测试 |
| **桌面应用** | Claude Desktop | ✅ 允许 | ✅ 允许 | 否 | 完全网络访问权限 |
| **CLI 工具** | Claude CLI | ✅ 允许 | ✅ 允许 | 否 | 继承终端环境权限 |
| **CLI 工具** | MCP Inspector | ✅ 允许 | ✅ 允许 | 否 | 开发调试工具，无限制 |

## 详细分析

### 1. AI IDE 类工具（Cursor, Windsurf 等）

**特点：**
- 通常在**沙箱环境**中运行 MCP 服务器
- 出于**安全考虑**限制局域网访问
- 防止恶意 MCP 服务器扫描或攻击本地网络

**网络策略：**
- ✅ **允许**: localhost (127.0.0.1)
- ✅ **允许**: 公网 IP 和域名
- ❌ **限制**: 私有网络 IP
  - 192.168.0.0/16
  - 10.0.0.0/8
  - 172.16.0.0/12

**原因：**
- IDE 需要保护用户的本地网络安全
- 防止未经授权的网络扫描
- 符合企业安全策略

**影响的 MCP 服务器：**
- ❌ MySQL MCP (连接局域网数据库)
- ❌ Redis MCP (连接局域网 Redis)
- ❌ PostgreSQL MCP (连接局域网数据库)
- ❌ MongoDB MCP (连接局域网数据库)
- ✅ 所有云服务 MCP (AWS, Azure, GCP 等)

### 2. 桌面应用类（Claude Desktop）

**特点：**
- 独立的桌面应用程序
- 拥有完整的系统权限
- 用户明确安装和授权

**网络策略：**
- ✅ **完全网络访问**
- 无沙箱限制
- 可以访问任何网络资源

**适用场景：**
- 需要访问局域网资源
- 企业内部部署
- 开发和测试环境

### 3. CLI 工具类（命令行工具）

**特点：**
- 在终端环境中运行
- 继承用户的 shell 权限
- 无额外安全限制

**网络策略：**
- ✅ **完全网络访问**
- 与普通命令行程序相同
- 受操作系统防火墙限制

**适用场景：**
- 自动化脚本
- CI/CD 流程
- 服务器端部署

## 为什么 AI IDE 会有这些限制？

### 安全考虑

1. **防止网络扫描**
   - 恶意 MCP 服务器可能扫描内网
   - 发现内网服务和漏洞
   - 窃取敏感信息

2. **防止横向移动**
   - 攻击者通过 MCP 服务器
   - 访问内网其他系统
   - 扩大攻击范围

3. **企业合规**
   - 符合企业安全策略
   - 满足数据保护要求
   - 通过安全审计

### 用户体验平衡

- **便利性**: 允许访问公网服务（云数据库、API 等）
- **安全性**: 限制访问私有网络
- **灵活性**: 提供 SSH 隧道等解决方案

## 解决方案对比

### 方案 1: SSH 隧道（推荐）

**适用于：** 所有受限的 AI IDE

**优点：**
- ✅ 安全（SSH 加密）
- ✅ 灵活（可以访问任何内网资源）
- ✅ 不需要修改 IDE 配置

**缺点：**
- ❌ 需要额外的终端窗口
- ❌ 需要 SSH 访问权限

**设置：**
```bash
ssh -L 3307:192.168.1.200:3306 user@192.168.1.200
```

### 方案 2: 使用云数据库

**适用于：** 所有工具

**优点：**
- ✅ 无需特殊配置
- ✅ 更好的可用性和性能
- ✅ 自动备份和维护

**缺点：**
- ❌ 需要成本
- ❌ 数据在云上

### 方案 3: 使用 Claude Desktop 或 CLI

**适用于：** 需要频繁访问局域网资源

**优点：**
- ✅ 无网络限制
- ✅ 无需 SSH 隧道
- ✅ 配置简单

**缺点：**
- ❌ 需要切换工具
- ❌ 可能缺少 IDE 集成功能

### 方案 4: VPN + 云端 IDE

**适用于：** 企业环境

**优点：**
- ✅ 安全的远程访问
- ✅ 统一的访问控制
- ✅ 审计和监控

**缺点：**
- ❌ 需要企业 VPN 基础设施
- ❌ 配置复杂

## 市面上其他 MCP 服务器的情况

### 数据库类 MCP

所有数据库 MCP 都会面临相同的问题：

- **MySQL MCP** ❌ 局域网受限
- **PostgreSQL MCP** ❌ 局域网受限
- **Redis MCP** ❌ 局域网受限
- **MongoDB MCP** ❌ 局域网受限
- **SQLite MCP** ✅ 本地文件，无影响

### API 类 MCP

通常不受影响（访问公网 API）：

- **GitHub MCP** ✅ 公网 API
- **Slack MCP** ✅ 公网 API
- **AWS MCP** ✅ 公网 API
- **Google MCP** ✅ 公网 API

### 文件系统类 MCP

通常不受影响（本地文件系统）：

- **Filesystem MCP** ✅ 本地文件
- **Git MCP** ✅ 本地仓库

## 测试你的环境

使用我们提供的测试脚本验证你的 MCP 客户端是否有网络限制：

```bash
# 测试局域网连接
export MYSQL_HOST=192.168.1.200
export MYSQL_PORT=3306
export MYSQL_USER=your_username
export MYSQL_PASSWORD=your_password
export MYSQL_DATABASE=your_database

node test-connection.js
```

**结果解读：**
- ✅ 测试成功 + MCP 失败 = 客户端有网络限制
- ✅ 测试成功 + MCP 成功 = 无网络限制
- ❌ 测试失败 = 网络或配置问题

## 建议

### 对于开发者

1. **优先使用云服务** - 避免网络限制问题
2. **提供 SSH 隧道文档** - 帮助用户解决局域网访问
3. **测试多个客户端** - 确保兼容性
4. **明确说明限制** - 在文档中说明网络要求

### 对于用户

1. **了解你的工具** - 知道是否有网络限制
2. **选择合适的方案** - SSH 隧道 vs 云服务
3. **安全第一** - 理解限制的安全原因
4. **测试验证** - 使用测试脚本确认

## 未来趋势

### 可能的改进

1. **细粒度权限控制**
   - 用户可以授权特定 IP 范围
   - 类似浏览器的权限请求

2. **安全白名单**
   - IDE 维护可信 MCP 服务器列表
   - 白名单内的服务器有更多权限

3. **企业策略配置**
   - IT 管理员可以配置网络策略
   - 满足不同企业的需求

## 总结

- **AI IDE（Cursor 等）**: 通常限制局域网访问，需要 SSH 隧道
- **桌面应用（Claude Desktop）**: 无限制，完全网络访问
- **CLI 工具**: 无限制，继承终端权限
- **所有数据库 MCP**: 都会受到相同的限制
- **解决方案**: SSH 隧道或使用云服务

这些限制是出于安全考虑，是合理的设计决策。
